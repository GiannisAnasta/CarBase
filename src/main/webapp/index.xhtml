<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:p="http://primefaces.org/ui">

    <f:view contentType="text/html">
        <h:head>
            <f:facet name="first">
                <meta content='text/html; charset=UTF-8' http-equiv="Content-Type"/>
                <title>Company</title>
            </f:facet>
            <h:outputStylesheet library="css" name="style.css"/>
        </h:head>
        <h:body>
            <ui:include src="language.xhtml"/>
            <ui:include src="add_company.xhtml"/>
            <!--  Start of upload form -->
            <h:form enctype="multipart/form-data" >
                <p:importEnum type="view.FormatOfData" var="formatsOfData" allSuffix="ALL_ENUM_VALUES" />
                <h:panelGrid columns="2" style="margin-bottom:10px" cellpadding="5">
                    <p:outputLabel for="formatOfData" value="#{msg.formatOfData}:" />
                    <p:selectOneRadio id="formatOfData" value="#{fileUploadView.formatOfData}">
                        <f:selectItems value="#{formatsOfData.ALL_ENUM_VALUES}" var="item"  itemLabel="#{msg[localizationKeyConvrtor.toLocalizationKey(item)]}" itemValue="#{item}" />
                        <p:ajax/>
                    </p:selectOneRadio>
                </h:panelGrid>
                <p:fileUpload fileUploadListener="#{fileUploadView.handleFileUpload}" mode="advanced" skinSimple="true" dragDropSupport="false" auto="true"
                              update="@all" allowTypes="/(\.|\/)(xlsx|xls)$/" label="#{msg.upload_new_file}"/>
            </h:form>
            <!--  End of upload form -->

            <p:ajaxStatus onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()" />
            <p:dialog widgetVar="statusDialog" draggable="false" closable="false" resizable="false" showHeader="false" position="right top" style=" border-color: lime " >
                <h:outputText value="#{msg.ajax_inticator_for_loading}"/>
            </p:dialog>
            <h:form id="companiesTableForm">
                <p:growl id="msgs" showDetail="false" sticky="true"/>
                <p:dataTable id="entities" var="company"
                             value="#{companiesManage.list}"
                             widgetVar="companiesTable" editable="true"
                             emptyMessage="#{msg.filtering_output_message_when_no_criteria}"
                             filteredValue="#{companyTableFilter.filteredCompanies}"
                             selection="#{rowSelection.selected}"
                             rowKey="#{company}"
                             paginator="true"
                             rows="10"
                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             rowsPerPageTemplate="5,10,15,50,100">
                    <p:column selectionMode="multiple" style="width:16px;text-align:center" exportable="false" toggleable="false"/>
                    <p:ajax event="rowEdit" listener="#{editCompanyBean.onRowEdit}" update="@this :companiesTableForm:msgs"/>
                    <p:ajax event="rowEditCancel" listener="#{editCompanyBean.onRowCancel}" update="@this :companiesTableForm:msgs"/>

                    <f:facet name="header">
                        <h:outputText value="#{msg.main_table_output_label_search_all_fields} "/>
                        <p:inputText id="globalFilter" onkeyup="PF('companiesTable').filter()" style="width:200px" placeholder="#{msg.filtering_placeholder_enterKey}" onkeypress="return event.keyCode !== 13"/>


                        <p:spacer height="10"/>

                        <p:commandButton id="toggler" type="button" value="#{msg.button_label_columns}" icon="ui-icon-calculator" update="@this" style="float:right; " />
                        <p:columnToggler datasource="entities" trigger="toggler">
                            <p:ajax event="toggle" listener="#{exportCompanies.onToggle}"/>
                        </p:columnToggler>
                        <p:commandButton value="#{msg.button_label_export_selected}"  icon="ui-icon-extlink"
                                         actionListener="#{exportCompanies.setFiltered(true)}"
                                         process="@this" ajax="false">
                            <p:fileDownload value="#{exportCompanies.exportXlsx(rowSelection.selected)}"/>
                        </p:commandButton>

                        <p:spacer height="10"/>

                        <p:commandButton value="#{msg.button_label_export_all}"  icon="ui-icon-extlink"
                                         actionListener="#{exportCompanies.setFiltered(false)}"
                                         process="@this" ajax="false">
                            <p:fileDownload value="#{exportCompanies.exportXlsx(companiesManage.list)}"/>
                        </p:commandButton>

                        <p:spacer height="10"/>
                        <p:commandButton process="entities" actionListener="#{rowSelection.deleteSelected()}" icon="ui-icon-trash" value="#{msg.button_label_delete_selected}" update="@form"/>
                        <p:spacer height="30"/>
                    </f:facet>
                    <!-- End of the datatable head -->

                    <!-- Start of the datatable body -->
                    <p:column filterBy="#{company.name}" headerText="#{msg.output_label_company_name}" footerText="#{msg.output_label_company_name}" filterMatchMode="contains" sortBy="#{company.name}">
                        <f:facet name="filter">
                            <p:inputText  onkeyup="PF('companiesTable').filter()" style="width:150px" placeholder="#{msg.main_table_placeholder_enter_name}" onkeypress="return event.keyCode !== 13"/>
                        </f:facet>
                        <p:cellEditor >
                            <f:facet name="output">
                                <h:outputText value="#{company.name}"/>
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{company.name}" style="width:97%" placeholder="#{msg.main_table_placeholder_enter_name}"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>
                    <p:column filterBy="#{company.site}" headerText="#{msg.output_label_site}" footerText="#{msg.output_label_site}" filterMatchMode="contains" >
                        <f:facet name="filter">
                            <p:inputText onkeyup="PF('companiesTable').filter()" style="width:150px" placeholder="#{msg.main_table_placeholder_enter_site}" onkeypress="return event.keyCode !== 13"/>
                        </f:facet>
                        <p:cellEditor>
                            <f:facet name="output">
                                <p:dataList value="#{company.site}" var="sitee" rendered="#{not empty company.site}">
                                    <a href="#{urlConverterUtil.normalize(sitee)}"
                                       target="_blank"
                                       style="#{urlConverterUtil.isValidScheme(scheme)? '' : 'color: red'}">#{sitee}</a>
                                </p:dataList>
                            </f:facet>
                            <f:facet name="input">
                                <p:inputTextarea value="#{company.site}" style="width: 97%; height:97%" placeholder="#{msg.main_table_placeholder_enter_site}">
                                    <f:converter converterId="ListStringConverter" />
                                </p:inputTextarea>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>
                    <p:column filterBy="#{company.email}" headerText="#{msg.output_label_email}" footerText="#{msg.output_label_email}" filterMatchMode="contains" >
                        <f:facet name="filter">
                            <p:inputText onkeyup="PF('companiesTable').filter()" style="width:150px" placeholder="#{msg.main_table_placeholder_enter_email}" onkeypress="return event.keyCode !== 13"/>
                        </f:facet>
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputLink target="_top"
                                              value="mailto:#{emailConverterUtil.getAsCommaSeparated(company.email)}"
                                              rendered="#{not empty company.email}">
                                    <h:outputText value="&#x2709;#{msg.mail_to_all}"/>
                                </h:outputLink>
                                <p:dataList value="#{company.email}"
                                            var="emaill" rendered="#{not empty company.email}">
                                    <h:outputLink target="_top" value="mailto:#{emaill}" >
                                        <h:outputText value="#{emaill}" />
                                    </h:outputLink>
                                </p:dataList>
                            </f:facet>
                            <f:facet name="input">
                                <p:inputTextarea value="#{company.email}" style="width: 97%; height:97%" placeholder="#{msg.main_table_placeholder_enter_email}">
                                    <f:converter converterId="ListStringConverter" />
                                </p:inputTextarea>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>
                    <p:column filterBy="#{company.telephones}" headerText="#{msg.output_label_telephone}" footerText="#{msg.output_label_telephone}" filterMatchMode="contains" >
                        <f:facet name="filter">
                            <p:inputText onkeyup="PF('companiesTable').filter()" style="width:150px" placeholder="#{msg.main_table_placeholder_enter_telephone}" onkeypress="return event.keyCode !== 13"/>
                        </f:facet>
                        <p:cellEditor>
                            <f:facet name="output">
                                <p:dataList value="#{company.telephones}" var="tels" rendered="#{not empty company.telephones}">
                                    <h:outputText value="#{tels}"/>
                                </p:dataList>
                            </f:facet>
                            <f:facet name="input">
                                <p:inputTextarea value="#{company.telephones}" style="width: 97%; height:97%" placeholder="#{msg.main_table_placeholder_enter_telephone}" >
                                    <f:converter converterId="ListStringConverter" />
                                </p:inputTextarea>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>
                    <p:column filterBy="#{company.details}" headerText="#{msg.output_label_comments}" footerText="#{msg.output_label_comments}" filterMatchMode="contains">
                        <f:facet name="filter">
                            <p:inputText onkeyup="PF('companiesTable').filter()" style="width:150px" placeholder="#{msg.main_table_placeholder_enter_comment}" onkeypress="return event.keyCode !== 13"/>
                        </f:facet>
                        <p:cellEditor>
                            <f:facet name="output">
                                <p:dataList value="#{company.details}" var="detail" rendered="#{not empty company.details}">
                                    <h:outputText value="#{detail}"/>
                                </p:dataList>
                            </f:facet>
                            <f:facet name="input">
                                <p:inputTextarea value="#{company.details}" style="width: 97%; height:97%" placeholder="#{msg.main_table_placeholder_enter_comment}" >
                                    <f:converter converterId="ListStringConverter" />
                                </p:inputTextarea>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>
                    <p:column headerText="#{msg.button_label_editing}" style="width:60px" exportable="false">
                        <p:rowEditor/>
                    </p:column>
                    <p:column headerText="#{msg.button_label_delete}" style="width:60px" exportable="false" >
                        <p:commandButton icon="ui-icon-trash"
                                         title="Delete"
                                         actionListener="#{removeCompanyBean.remove(company)}"
                                         ajax="false"/>
                    </p:column>
                    <f:facet name="footer">
                        <p:column>
                            <p style="text-align: left; color:royalblue">#{msg.support_feedback}:</p>
                            <p style="text-align: left; color:royalblue">AIoannis@speedflow.com </p>
                            <p style="text-align: right; color:royalblue"> Companies, Copyright © 2016</p>
                            <p style="text-align: right;  font-style: italic ; color:royalblue">#{msg.developer_who_created_ia} - #{msg.developer_who_created_ym}</p>
                        </p:column>
                    </f:facet>
                </p:dataTable>
            </h:form>
            <!-- End of the datatable body -->

        </h:body>
    </f:view>
</html>

